# 龙芯LS2K0300摄像头项目 - 交叉编译完成

## ✅ 编译状态

**交叉编译已成功完成！**

- 编译日期: 2025-11-07
- 目标架构: LoongArch 64-bit
- 工具链: loongson-gnu-toolchain-8.3
- OpenCV版本: 4.8.0

---

## 📁 生成的文件

可执行文件已保存到: `/home/cjw/ls2k0300_camera_project/output/`

```bash
ls -lh /home/cjw/ls2k0300_camera_project/output/
```

输出：
- **camera_display_ips200** (43KB) - IPS200屏幕版本 ⭐ **推荐用于板卡**
- **camera_display** (60KB) - OpenCV窗口版本（需要X11）

---

## 📤 传输到龙芯板卡

### 方法 1: 使用 SCP（推荐）

```bash
# 替换 <板卡IP> 为您的板卡实际IP地址
scp /home/cjw/ls2k0300_camera_project/output/camera_display_ips200 root@<板卡IP>:/root/

# 示例:
# scp /home/cjw/ls2k0300_camera_project/output/camera_display_ips200 root@192.168.1.100:/root/
```

### 方法 2: 使用 USB 存储设备

1. 将 `/home/cjw/ls2k0300_camera_project/output/camera_display_ips200` 复制到 U 盘
2. 在板卡上挂载 U 盘并复制文件

### 方法 3: 使用共享文件夹

如果您的虚拟机与板卡共享文件夹：

```bash
cp /home/cjw/ls2k0300_camera_project/output/camera_display_ips200 /path/to/shared/folder/
```

---

## 🚀 在板卡上运行

### 1. 给予执行权限

```bash
chmod +x camera_display_ips200
```

### 2. 检查硬件设备

```bash
# 检查 USB 摄像头
ls -l /dev/video0

# 检查 IPS200 屏幕（Framebuffer）
ls -l /dev/fb0

# 检查 UVC 驱动
lsmod | grep uvc
```

### 3. 运行程序

```bash
./camera_display_ips200
```

### 4. 预期输出

```
========================================
  USB摄像头 + IPS200屏幕显示 Demo
  基于逐飞IPS200开源库实现
========================================

[1/2] 正在初始化 IPS200 屏幕...
IPS200 Screen Info: 240x320, bpp=16
IPS200 display initialized successfully

[2/2] 正在初始化 USB 摄像头...
Camera opened successfully: /dev/video0
Camera settings: 160x120 @ 30 FPS
USB摄像头初始化成功！

开始采集并显示图像...
按 Ctrl+C 退出程序

实时帧率: 29.8 FPS, 总帧数: 30
实时帧率: 29.9 FPS, 总帧数: 60
...
```

### 5. 退出程序

按 `Ctrl+C` 安全退出

---

## 🔧 重新编译

如果需要修改代码后重新编译：

```bash
cd /home/cjw/ls2k0300_camera_project/application/camera_display
./build_cross.sh
```

编译完成后，新的可执行文件会自动保存到 `output` 目录。

---

## 📋 项目文件说明

### 编译脚本

- `build_cross.sh` - **交叉编译脚本**（在 x86 Linux 上运行）
- `build_onboard.sh` - 板卡本地编译脚本（在龙芯板卡上运行，可选）
- `build.sh` - 原始编译脚本（本地 x86 编译，仅用于测试语法）

### 源代码

```
application/camera_display/
├── src/
│   ├── main.cpp              # IPS200版本主程序
│   ├── main_generic.cpp      # OpenCV窗口版本主程序
│   ├── uvc_camera.cpp        # USB摄像头采集模块
│   ├── ips200_display.cpp    # IPS200屏幕显示模块
│   └── screen_display.cpp    # OpenCV窗口显示模块
├── include/
│   ├── uvc_camera.h
│   ├── ips200_display.h
│   └── screen_display.h
└── CMakeLists.txt
```

---

## 🐛 常见问题

### 1. 程序运行时提示 "找不到库文件"

**原因**: 板卡上缺少 OpenCV 库

**解决方法**:
```bash
# 在板卡上检查 OpenCV 库
ls /usr/lib64/libopencv*.so

# 如果没有，需要从 rootfs 复制
# （联系我获取具体操作步骤）
```

### 2. 摄像头打开失败

**原因**:
- USB摄像头未插入
- 摄像头设备节点不是 `/dev/video0`

**解决方法**:
```bash
# 查看所有视频设备
ls -l /dev/video*

# 如果设备是 /dev/video1，修改代码中的设备路径
```

### 3. 屏幕无显示

**原因**:
- IPS200屏幕未正确连接
- 设备树配置不正确
- Framebuffer驱动未加载

**解决方法**:
```bash
# 检查 Framebuffer 设备
ls -l /dev/fb0

# 查看内核日志
dmesg | grep fb
dmesg | grep st7789v
```

### 4. 帧率较低

**可能原因**:
- USB带宽不足
- CPU性能限制

**优化方法**:
- 降低摄像头分辨率（修改 `uvc_camera.h` 中的宏定义）
- 使用 USB 2.0 端口而不是 USB 1.1

---

## 📊 项目进度总结

### 已完成 ✅

1. ✅ USB摄像头采集模块（OpenCV + V4L2）
2. ✅ IPS200屏幕显示模块（Framebuffer）
3. ✅ 双版本应用（IPS200 + OpenCV窗口）
4. ✅ 交叉编译环境配置
5. ✅ 成功生成龙芯可执行文件
6. ✅ 完整的构建脚本和文档

### 待测试 🔄

1. 在实际硬件上运行测试
2. 性能优化和调优
3. 错误处理和异常情况测试

---

## 📞 技术支持

如有问题，请检查：

1. `/home/cjw/ls2k0300_camera_project/PROJECT_ANALYSIS_REPORT.md` - 项目详细分析
2. `/home/cjw/ls2k0300_camera_project/application/camera_display/README.md` - 应用说明
3. 源代码注释

---

**生成时间**: 2025-11-07
**编译环境**: Ubuntu x86_64 虚拟机
**目标平台**: 龙芯LS2K0300 (LoongArch64)
